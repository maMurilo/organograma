<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Organograma Interativo de Fazendas</title>

<!-- Panzoom CDN -->
<script src="https://unpkg.com/@panzoom/panzoom@9.4.0/dist/panzoom.min.js"></script>

<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background-color: #fff;
    margin: 0;
    padding: 10px;
    text-align: center;
  }

  h2 {
    margin: 10px 0 20px;
  }

  select {
    padding: 5px 10px;
    margin: 5px;
    font-size: 14px;
  }

  #wrapper {
    border: 1px solid #ddd;
    width: 100%;
    height: 85vh;
    overflow: hidden;
    position: relative;
    background-color: #fafafa;
    border-radius: 8px;
  }

  #organograma {
    transform-origin: center center;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100%;
  }

  .tree ul {
    display: flex;
    justify-content: center;
    position: relative;
    padding-top: 40px;
    flex-wrap: wrap;
  }

  .tree li {
    list-style: none;
    text-align: center;
    position: relative;
    margin: 20px;
  }

  .tree li::before, .tree li::after {
    content: '';
    position: absolute;
    top: 0;
    border-top: 2px solid #ccc;
    width: 50%;
    height: 20px;
  }

  .tree li::before { right: 50%; }
  .tree li::after { left: 50%; }
  .tree li:only-child::before, .tree li:only-child::after { display: none; }

  .tree li:only-child { padding-top: 0; }

  .tree li > ul::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    border-left: 2px solid #ccc;
    height: 30px;
  }

  /* Estilo das caixas */
  .box {
    color: #333;
    background-color: #fff;
    border: 3px solid #ccc;
    border-radius: 10px;
    padding: 10px 20px;
    display: inline-block;
    font-weight: 600;
    min-width: 130px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }

  /* cores por fazenda */
  .FESP .box { border-color: #f97316; } /* Laranja */
  .FPA .box { border-color: #22c55e; }  /* Verde */
  .FSTV .box { border-color: #3b82f6; } /* Azul */
  .FBG .box, .FEA .box, .FBLA .box { border-color: #8b5cf6; } /* Roxo */
  .MTR .box { border-color: #eab308; } /* Amarelo */

  .fazenda-titulo {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
  }

  /* Melhor alinhamento visual */
  .tree {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
</style>
</head>
<body>
  <h2>Organograma Interativo de Fazendas</h2>

  <div>
    <label>Fazenda:</label>
    <select id="fazendaSelect"></select>

    <label>Líder:</label>
    <select id="liderSelect"></select>
  </div>

  <div id="wrapper">
    <div id="organograma"></div>
  </div>

<script>
  const relacoes = [
    { fazenda:"FESP", lider: "Ana", liderado: "Bruno" },
    { fazenda:"FESP", lider: "Ana", liderado: "Pedro" },
    { fazenda:"FESP", lider: "Ana", liderado: "João" },
    { fazenda:"FPA",  lider: "Ana", liderado: "Julia" },
    { fazenda:"FSTV", lider: "Bruno", liderado: "Carlos" },
    { fazenda:"FSTV", lider: "Carlos", liderado: "Joao" },
    { fazenda:"MTR",  lider: "Pedro", liderado: "Maria" },
    { fazenda:"FPA",  lider: "Maria", liderado: "Lara" },
    { fazenda:"FBG",  lider: "Maria", liderado: "Lara" },
    { fazenda:"FEA",  lider: "Maria", liderado: "Lara" },
    { fazenda:"FBLA", lider: "Maria", liderado: "Lara" },
    { fazenda:"FESP", lider: "Maria", liderado: "Lara" }
  ];

  const fazendaSelect = document.getElementById("fazendaSelect");
  const liderSelect = document.getElementById("liderSelect");
  const organogramaDiv = document.getElementById("organograma");

  // Fazendas e líderes únicos
  const fazendasUnicas = [...new Set(relacoes.map(r => r.fazenda))];
  const lideresUnicos = [...new Set(relacoes.map(r => r.lider))];
  fazendaSelect.innerHTML = "<option value='Todos'>Todos</option>" + fazendasUnicas.map(f => `<option value='${f}'>${f}</option>`).join('');
  liderSelect.innerHTML = "<option value='Todos'>Todos</option>" + lideresUnicos.map(l => `<option value='${l}'>${l}</option>`).join('');

  // Função constrói árvore hierárquica
  function buildTree(relacoes, liderInicial = null) {
    const mapa = {};
    const todos = new Set();

    relacoes.forEach(({lider, liderado}) => {
      if (!mapa[lider]) mapa[lider] = [];
      mapa[lider].push(liderado);
      todos.add(lider);
      todos.add(liderado);
    });

    let topo = liderInicial;
    if (!topo) {
      const liderados = new Set(relacoes.map(r => r.liderado));
      topo = [...todos].find(p => !liderados.has(p));
    }

    if (!topo) return null;

    function createNode(nome) {
      const li = document.createElement("li");
      const div = document.createElement("div");
      div.className = "box";
      div.textContent = nome;
      li.appendChild(div);

      if (mapa[nome]) {
        const filhos = mapa[nome];
        for (let i = 0; i < filhos.length; i += 6) {
          const grupo = filhos.slice(i, i + 6);
          const ul = document.createElement("ul");
          grupo.forEach(filho => ul.appendChild(createNode(filho)));
          li.appendChild(ul);
        }
      }
      return li;
    }

    const ul = document.createElement("ul");
    ul.appendChild(createNode(topo));
    return ul;
  }

  fazendaSelect.addEventListener("change", render);
  liderSelect.addEventListener("change", render);

  function render() {
    organogramaDiv.innerHTML = "";
    const fz = fazendaSelect.value;
    const ld = liderSelect.value;

    if (fz === "Todos" && ld === "Todos") {
      fazendasUnicas.forEach(f => appendBloco(f, relacoes.filter(r => r.fazenda === f)));
      return;
    }

    if (fz !== "Todos" && ld === "Todos") {
      const lideres = [...new Set(relacoes.filter(r => r.fazenda === fz).map(r => r.lider))];
      lideres.forEach(l => appendBloco(fz, relacoes.filter(r => r.fazenda === fz && r.lider === l), l));
      return;
    }

    if (fz === "Todos" && ld !== "Todos") {
      const fazendasDoLider = [...new Set(relacoes.filter(r => r.lider === ld).map(r => r.fazenda))];
      fazendasDoLider.forEach(f => appendBloco(f, relacoes.filter(r => r.fazenda === f && r.lider === ld), ld));
      return;
    }

    if (fz !== "Todos" && ld !== "Todos") {
      appendBloco(fz, relacoes.filter(r => r.fazenda === fz && r.lider === ld), ld);
      return;
    }
  }

  function appendBloco(fazenda, rel, lider=null) {
    const bloco = document.createElement("div");
    bloco.className = `tree ${fazenda}`;
    const titulo = document.createElement("div");
    titulo.className = "fazenda-titulo";
    titulo.textContent = lider ? `${fazenda} - ${lider}` : fazenda;
    bloco.appendChild(titulo);
    const tree = buildTree(rel, lider);
    if (tree) bloco.appendChild(tree);
    organogramaDiv.appendChild(bloco);
  }

  // Ativar Panzoom
  const panzoom = Panzoom(document.getElementById("organograma"), {
    maxScale: 3,
    minScale: 0.5,
    contain: 'outside',
  });
  document.getElementById("wrapper").addEventListener("wheel", panzoom.zoomWithWheel);

  render(); // inicializa
</script>
</body>
</html>
