<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Organograma de Fazendas</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 20px;
    background-color: #fff;
  }

  h2 {
    margin-bottom: 10px;
  }

  select {
    padding: 5px 10px;
    margin: 5px;
    font-size: 14px;
  }

  .tree {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 60px;
  }

  .fazenda-bloco {
    display: inline-block;
  }

  .fazenda-titulo {
    font-weight: bold;
    margin-bottom: 15px;
    font-size: 18px;
    color: #2c3e50;
  }

  .tree ul {
    position: relative;
    display: flex;
    justify-content: center;
    padding-top: 30px;
    flex-wrap: wrap;
  }

  .tree li {
    list-style-type: none;
    text-align: center;
    position: relative;
    padding: 20px 10px 0 10px;
  }

  .tree li::before, .tree li::after {
    content: '';
    position: absolute;
    top: 0;
    border-top: 2px solid #ccc;
    width: 50%;
    height: 20px;
  }

  .tree li::before { right: 50%; }
  .tree li::after { left: 50%; }

  .tree li:only-child::before, 
  .tree li:only-child::after { display: none; }

  .tree li:only-child { padding-top: 0; }

  .tree li > ul::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    border-left: 2px solid #ccc;
    height: 30px;
  }

  .box {
    background-color: #ff5400;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    display: inline-block;
    min-width: 100px;
    text-align: center;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .lider {
    background-color: #ff5400;
  }

  .liderado {
    background-color: #ff7f50;
  }
</style>
</head>
<body>
  <h2>Organograma de Fazendas</h2>

  <div>
    <label for="fazendaSelect">Fazenda:</label>
    <select id="fazendaSelect">
      <option value="">-- Selecione --</option>
    </select>

    <label for="liderSelect">Líder:</label>
    <select id="liderSelect">
      <option value="">-- Selecione --</option>
    </select>
  </div>

  <div id="organograma" class="tree"></div>

  <script>
    const relacoes = [
      { fazenda:"FESP", lider: "Ana", liderado: "Bruno" },
      { fazenda:"FESP", lider: "Bruno", liderado: "Leo" },
      { fazenda:"FESP", lider: "Bruno", liderado: "Pedro" },
      { fazenda:"FESP", lider: "Pedro", liderado: "Larrisa" },
      { fazenda:"FESP", lider: "Ana", liderado: "Pedro" },
      { fazenda:"FESP", lider: "Ana", liderado: "João" },
      { fazenda:"FPA",  lider: "Ana", liderado: "Julia" },
      { fazenda:"FSTV", lider: "Bruno", liderado: "Carlos" },
      { fazenda:"FSTV", lider: "Carlos", liderado: "Joao" },
      { fazenda:"MTR",  lider: "Pedro", liderado: "Maria" },
      { fazenda:"FPA",  lider: "Maria", liderado: "Lara" },
      { fazenda:"FBG",  lider: "Maria", liderado: "Lara" },
      { fazenda:"FEA",  lider: "Maria", liderado: "Lara" },
      { fazenda:"FBLA", lider: "Maria", liderado: "Lara" },
      { fazenda:"FESP", lider: "Maria", liderado: "Lara" }
    ];

    const fazendaSelect = document.getElementById("fazendaSelect");
    const liderSelect = document.getElementById("liderSelect");
    const organogramaDiv = document.getElementById("organograma");

    // Popula fazendas
    const fazendasUnicas = [...new Set(relacoes.map(r => r.fazenda))];
    fazendasUnicas.sort().unshift("Todos");
    fazendasUnicas.forEach(f => {
      const opt = document.createElement("option");
      opt.value = f;
      opt.textContent = f;
      fazendaSelect.appendChild(opt);
    });

    // Popula líderes
    const lideresUnicos = [...new Set(relacoes.map(r => r.lider))];
    lideresUnicos.sort().unshift("Todos");
    lideresUnicos.forEach(l => {
      const opt = document.createElement("option");
      opt.value = l;
      opt.textContent = l;
      liderSelect.appendChild(opt);
    });

    // Constrói árvore
    function buildTree(relacoes, liderInicial = null) {
      const mapa = {};
      const todos = new Set();

      relacoes.forEach(({lider, liderado}) => {
        if (!mapa[lider]) mapa[lider] = [];
        mapa[lider].push(liderado);
        todos.add(lider);
        todos.add(liderado);
      });

      let topo = liderInicial;
      if (!topo) {
        const liderados = new Set(relacoes.map(r => r.liderado));
        topo = [...todos].find(p => !liderados.has(p));
      }

      if (!topo) return null;

      function createNode(nome) {
        const li = document.createElement("li");
        const div = document.createElement("div");
        div.className = "box " + (mapa[nome] ? "lider" : "liderado");
        div.textContent = nome;
        li.appendChild(div);

        if (mapa[nome]) {
          const filhos = mapa[nome];
          for (let i = 0; i < filhos.length; i += 6) {
            const grupo = filhos.slice(i, i + 6);
            const ul = document.createElement("ul");
            grupo.forEach(filho => ul.appendChild(createNode(filho)));
            li.appendChild(ul);
          }
        }
        return li;
      }

      const ul = document.createElement("ul");
      ul.appendChild(createNode(topo));
      return ul;
    }

    // Eventos
    fazendaSelect.addEventListener("change", renderOrganograma);
    liderSelect.addEventListener("change", renderOrganograma);

    function renderOrganograma() {
      organogramaDiv.innerHTML = "";
      const fazendaSelecionada = fazendaSelect.value;
      const liderSelecionado = liderSelect.value;

      // Nenhuma seleção
      if (!fazendaSelecionada && !liderSelecionado) return;

      // Caso “Todos” geral
      if (fazendaSelecionada === "Todos" && liderSelecionado === "Todos") {
        fazendasUnicas.filter(f => f !== "Todos").forEach(f => {
          const bloco = criarBloco(f, relacoes.filter(r => r.fazenda === f));
          organogramaDiv.appendChild(bloco);
        });
        return;
      }

      // Caso apenas líder específico
      if (!fazendaSelecionada && liderSelecionado && liderSelecionado !== "Todos") {
        const fazendasDoLider = [...new Set(relacoes.filter(r => r.lider === liderSelecionado).map(r => r.fazenda))];
        fazendasDoLider.forEach(f => {
          const relacoesFazenda = relacoes.filter(r => r.fazenda === f && r.lider === liderSelecionado);
          const bloco = criarBloco(f, relacoesFazenda, liderSelecionado);
          organogramaDiv.appendChild(bloco);
        });
        return;
      }

      // Caso fazenda + líder “Todos” → monta todos os líderes dessa fazenda
      if (fazendaSelecionada && fazendaSelecionada !== "Todos" && liderSelecionado === "Todos") {
        const lideresFazenda = [...new Set(relacoes.filter(r => r.fazenda === fazendaSelecionada).map(r => r.lider))];
        lideresFazenda.forEach(l => {
          const relacoesFazenda = relacoes.filter(r => r.fazenda === fazendaSelecionada && r.lider === l);
          const bloco = criarBloco(fazendaSelecionada, relacoesFazenda, l);
          organogramaDiv.appendChild(bloco);
        });
        return;
      }

      // Caso fazenda + líder específico
      if (fazendaSelecionada && liderSelecionado && liderSelecionado !== "Todos") {
        const relacoesFazenda = relacoes.filter(r => r.fazenda === fazendaSelecionada && r.lider === liderSelecionado);
        const bloco = criarBloco(fazendaSelecionada, relacoesFazenda, liderSelecionado);
        organogramaDiv.appendChild(bloco);
        return;
      }

      // Caso só fazenda (sem líder)
      if (fazendaSelecionada && fazendaSelecionada !== "Todos") {
        const relacoesFazenda = relacoes.filter(r => r.fazenda === fazendaSelecionada);
        const bloco = criarBloco(fazendaSelecionada, relacoesFazenda);
        organogramaDiv.appendChild(bloco);
      }
    }

    function criarBloco(nomeFazenda, relacoesFazenda, lider = null) {
      const bloco = document.createElement("div");
      bloco.className = "fazenda-bloco";
      const titulo = document.createElement("div");
      titulo.className = "fazenda-titulo";
      titulo.textContent = lider ? `${nomeFazenda} - ${lider}` : nomeFazenda;
      bloco.appendChild(titulo);
      const tree = buildTree(relacoesFazenda, lider);
      if (tree) bloco.appendChild(tree);
      return bloco;
    }
  </script>
</body>
</html>
